<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KORVIL — Sistema K</title>

  <!-- CSS principal -->
  <link rel="stylesheet" href="./css/style.css" />

  <!-- Estilos do K-AI (apenas o necessário pro cubo/chat) -->
  <style>
    /* ====== K-AI Chatbot (canto inferior direito) ====== */
    .kai-chatbot{
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 64px;
      height: 64px;
      z-index: 9999;
      font-family: Arial, sans-serif;
    }
    .kai-chatbot .scene{ width:64px; height:64px; perspective:600px; }
    .kai-chatbot .cube{
      width:64px; height:64px; position:relative;
      transform-style:preserve-3d;
      animation: kaiSpin 6s linear infinite;
      cursor:pointer;
      transition: transform .5s, width .5s, height .5s;
    }
    .kai-chatbot .cube.expanded{ width:128px; height:128px; }
    .kai-chatbot .cube-face{
      position:absolute; width:64px; height:64px;
      background: linear-gradient(135deg,#00eaff,#007a8a);
      border:2px solid #00eaff;
      display:flex; align-items:center; justify-content:center;
      font-weight:800; color:#fff; font-size:14px;
      border-radius:6px;
      box-shadow: 0 6px 20px rgba(0,230,255,.5);
      user-select:none;
    }
    .kai-chatbot .front  { transform: rotateY(0deg) translateZ(32px); }
    .kai-chatbot .back   { transform: rotateY(180deg) translateZ(32px); }
    .kai-chatbot .right  { transform: rotateY(90deg) translateZ(32px); }
    .kai-chatbot .left   { transform: rotateY(-90deg) translateZ(32px); }
    .kai-chatbot .top    { transform: rotateX(90deg) translateZ(32px); }
    .kai-chatbot .bottom { transform: rotateX(-90deg) translateZ(32px); }
    @keyframes kaiSpin{
      0%{transform:rotateX(-15deg) rotateY(0deg);}
      100%{transform:rotateX(-15deg) rotateY(360deg);}
    }

    .kai-message{
      position: absolute;
      bottom: 78px;
      right: 0;
      max-width: 280px;
      padding: 10px 12px;
      background: rgba(0,230,255,0.08);
      border: 2px solid #00eaff;
      border-radius: 10px;
      color: #fff;
      font-size: 13px;
      opacity: 0;
      transform: translateY(8px);
      transition: all .25s;
      pointer-events:none;
    }
    .kai-message.show{ opacity:1; transform: translateY(0); }

    .kai-window{
      display:none;
      position:absolute;
      bottom: 78px;
      right: 0;
      width: 300px;
      max-height: 420px;
      background: rgba(16,24,38,0.96);
      border: 2px solid #00eaff;
      border-radius: 12px;
      overflow: hidden;
      flex-direction: column;
    }
    .kai-window.open{ display:flex; }
    .kai-head{
      background:#00eaff;
      color:#0b0f14;
      padding: 8px 12px;
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .kai-close{
      border:none;
      background: rgba(0,0,0,.12);
      color:#0b0f14;
      font-weight:900;
      border-radius:8px;
      padding:4px 10px;
      cursor:pointer;
    }
    .kai-body{
      padding: 10px;
      overflow:auto;
      color:#fff;
      font-size: 14px;
      line-height: 1.35;
      flex:1;
    }
    .kai-row{
      border-top: 1px solid rgba(0,230,255,.35);
      display:flex;
      gap:8px;
      padding: 10px;
      align-items:center;
      background: rgba(255,255,255,0.03);
    }
    .kai-input{
      flex:1;
      border: 1px solid rgba(0,230,255,.35);
      background: rgba(0,0,0,.2);
      color:#fff;
      border-radius: 10px;
      padding: 10px 10px;
      outline:none;
      font-size: 14px;
    }
    .kai-send{
      border:none;
      background:#00eaff;
      color:#0b0f14;
      font-weight:900;
      border-radius:10px;
      padding: 10px 12px;
      cursor:pointer;
    }
    .kai-bubble{
      margin: 8px 0;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,230,255,.25);
      background: rgba(0,230,255,0.06);
    }
    .kai-bubble.you{
      border-color: rgba(255,255,255,.18);
      background: rgba(255,255,255,0.06);
    }
    .kai-small{
      opacity:.85;
      font-size: 12px;
      margin-top: 4px;
    }
  </style>
</head>

<body>
  <!-- ===== TOPO ===== -->
  <header class="topo">
    <div class="topo__wrap">
      <a class="brand" href="#" data-go="home" aria-label="KORVIL Home">
        <span class="brand__logo">K</span>
        <span class="brand__name">KORVIL</span>
      </a>

      <button class="menuBtn" id="menuBtn" aria-label="Abrir menu" aria-expanded="false">☰</button>

      <nav class="nav" id="nav">
        <a class="nav__link is-active" href="#" data-go="home">Home</a>
        <a class="nav__link" href="#" data-go="sistemak">Sistema K</a>
        <a class="nav__link" href="#" data-go="ktp">K-TP</a>
        <a class="nav__link" href="#" data-go="k-afortunado">K-AFORTUNADO</a>
        <a class="nav__link" href="#" data-go="k-alma">K-ALMA</a>
        <a class="nav__link" href="#" data-go="kstore">K-Store</a>
        <a class="nav__link" href="#" data-go="checkout">Checkout</a>
      </nav>
    </div>
  </header>

  <!-- ✅ Sem home hardcoded aqui (evita duplicar). O app.js vai carregar sections/home.html -->
  <main id="app" class="app" aria-live="polite"></main>

  <footer class="rodape">
    <div class="rodape__wrap">
      <p class="muted">© 2026 KORVIL — Sistema K Integrado</p>
      <a class="link" href="#" id="contactBtn">Entre em contato conosco</a>
    </div>
  </footer>

  <!-- ✅ K-AI (APENAS AQUI) -->
  <div class="kai-chatbot" id="kaiChatbot">
    <div class="scene">
      <div class="cube" id="kaiCube">
        <div class="cube-face front">K-AI</div>
        <div class="cube-face back">K-AI</div>
        <div class="cube-face right">K-AI</div>
        <div class="cube-face left">K-AI</div>
        <div class="cube-face top">K-AI</div>
        <div class="cube-face bottom">K-AI</div>
      </div>
    </div>

    <div class="kai-message" id="kaiToast"></div>

    <div class="kai-window" id="kaiWindow" aria-hidden="true">
      <div class="kai-head">
        <span>K-AI Assistente</span>
        <button class="kai-close" id="kaiCloseBtn" type="button">×</button>
      </div>
      <div class="kai-body" id="kaiBody"></div>
      <div class="kai-row">
        <input class="kai-input" id="kaiInput" placeholder="Pergunte algo sobre o KORVIL..." />
        <button class="kai-send" id="kaiSendBtn" type="button">Enviar</button>
      </div>
    </div>
  </div>

  <!-- JS principal do site -->
  <script src="./js/app.js" defer></script>

  <!-- K-AI JS inline (pra não duplicar com kai-core/kai.js) -->
  <script>
    (function(){
      const cube = document.getElementById("kaiCube");
      const toast = document.getElementById("kaiToast");
      const win = document.getElementById("kaiWindow");
      const body = document.getElementById("kaiBody");
      const input = document.getElementById("kaiInput");
      const send = document.getElementById("kaiSendBtn");
      const closeBtn = document.getElementById("kaiCloseBtn");

      let holdTimer = null;
      let expanded = false;

      function showToast(text){
        toast.textContent = text;
        toast.classList.add("show");
        setTimeout(()=>toast.classList.remove("show"), 2200);
      }

      // Voz masculina (melhor esforço)
      function pickVoice(){
        const voices = window.speechSynthesis?.getVoices?.() || [];
        const pt = voices.filter(v => (v.lang || "").toLowerCase().startsWith("pt"));
        // tenta “male”
        let v = pt.find(v => (v.name || "").toLowerCase().includes("male"));
        // tenta vozes comuns (não garante masculino, mas geralmente é mais “neutro”)
        if(!v) v = pt.find(v => (v.name || "").toLowerCase().includes("google"));
        if(!v) v = pt[0] || voices[0] || null;
        return v;
      }

      function speak(text){
        if(!("speechSynthesis" in window)) return;
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "pt-BR";
        u.rate = 1;
        u.pitch = 0.9; // ligeiramente mais grave
        u.voice = pickVoice();
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      }

      function bubble(who, text){
        const div = document.createElement("div");
        div.className = "kai-bubble" + (who === "Você" ? " you" : "");
        div.innerHTML = "<strong>" + who + ":</strong> " + text;
        body.appendChild(div);
        body.scrollTop = body.scrollHeight;
      }

      function siteAnswer(q){
        const t = q.toLowerCase();

        // Respostas “sobre o site”
        if(t.includes("menu")) return "O menu fica no topo. No celular, toque no ☰ para abrir/fechar.";
        if(t.includes("k-store") || t.includes("loja")) return "A K-Store é a loja virtual do KORVIL: produtos, carrinho e checkout.";
        if(t.includes("checkout") || t.includes("pagamento")) return "No Checkout você finaliza pedidos e escolhe forma de pagamento (simulado).";
        if(t.includes("k-tp") || t.includes("transformação") || t.includes("projeto")) return "O K-TP é o Projeto TRANSFORMAÇÃO com inscrição e dados do participante.";
        if(t.includes("k-alma") || t.includes("cuidados") || t.includes("saúde")) return "K-ALMA: serviços de saúde e cuidados (terapia, fisio, psicologia, etc.).";
        if(t.includes("k-afortunado") || t.includes("curso") || t.includes("empreendedor")) return "K-AFORTUNADO: empreendedorismo, cursos e crescimento profissional.";
        if(t.includes("sistema k")) return "Sistema K: núcleo do ecossistema, serviços e integrações do KORVIL.";

        return "Posso te guiar no site: diga o setor (K-TP, K-Store, K-AFORTUNADO, K-ALMA, Sistema K) ou o que você quer fazer.";
      }

      function openChat(){
        win.classList.add("open");
        win.setAttribute("aria-hidden","false");
      }
      function closeChat(){
        win.classList.remove("open");
        win.setAttribute("aria-hidden","true");
      }
      function toggleChat(){
        if(win.classList.contains("open")) closeChat();
        else openChat();
      }

      // Clique e segure: expandir
      cube.addEventListener("pointerdown", () => {
        holdTimer = setTimeout(() => {
          expanded = !expanded;
          cube.classList.toggle("expanded", expanded);
          showToast(expanded ? "Cubo expandido!" : "Cubo reduzido!");
        }, 900);
      });
      cube.addEventListener("pointerup", () => clearTimeout(holdTimer));
      cube.addEventListener("pointerleave", () => clearTimeout(holdTimer));

      // Clique normal: abre/fecha chat
      cube.addEventListener("click", () => {
        // se o hold disparou, o click pode vir em seguida; mas como limpamos no pointerup, ok
        toggleChat();
        showToast(win.classList.contains("open") ? "K-AI ativado!" : "K-AI fechado!");
      });

      closeBtn.addEventListener("click", () => closeChat());

      function sendMsg(){
        const q = (input.value || "").trim();
        if(!q) return;
        bubble("Você", q);
        input.value = "";
        const a = siteAnswer(q);
        bubble("K-AI", a);
        speak(a);
      }

      send.addEventListener("click", sendMsg);
      input.addEventListener("keydown", (e) => {
        if(e.key === "Enter"){ e.preventDefault(); sendMsg(); }
      });

      // Carrega vozes (alguns browsers só populam depois)
      if("speechSynthesis" in window){
        window.speechSynthesis.onvoiceschanged = () => pickVoice();
      }
    })();
  </script>
</body>
</html>
